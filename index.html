<!-- ðŸ”¹ Sadece ilgili kÄ±sÄ±m deÄŸiÅŸti: cardTemplate() fonksiyonundaki DM linki -->
<script>
  /* ====== AYARLAR ====== */

  const SHEET_CSV_URL =
    "data:text/csv;charset=utf-8,sku%2Ctitle%2Cbrand%2Cprice%2Cimage%2Cpayment_link%2Cstatus%0ASKU1%2CCoach%20Tabby%2026%2CCoach%2C229%2Clogo.png%2Chttps%3A%2F%2Fbuy.stripe.com%2Ftest_ABC%2Cactive%0ASKU2%2CNike%20Air%20Force%201%2CNike%2C129%2Clogo.png%2Chttps%3A%2F%2Fbuy.stripe.com%2Ftest_DEF%2Cactive";

  const BRANDS_FILES = [
    "coach.png","michael-kors.png","tory-burch.png","marc-jacobs.png","dkny.png",
    "karl-lagerfeld.png","columbia.png","north-face.png","new-balance.png","nike-factory.png"
  ];

  const INSTAGRAM_URL = "https://www.instagram.com/orlandooutlet/";

  const PARALLAX_SPEED = 0.2;
  const heroBg = document.getElementById('heroParallax');
  window.addEventListener('scroll', ()=> {
    const y = window.scrollY * PARALLAX_SPEED;
    heroBg.style.transform = `translateY(${y}px)`;
  }, {passive:true});

  async function fetchCSV(url){
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error("CSV eriÅŸilemedi");
    const text = await res.text();
    return parseCSV(text);
  }

  function parseCSV(text){
    const rows=[]; let cur='', row=[], q=false;
    for(let i=0;i<text.length;i++){
      const c=text[i], n=text[i+1];
      if(c==='\"'){ if(q && n==='\"'){cur+='\"'; i++} else q=!q; }
      else if(c===',' && !q){ row.push(cur.trim()); cur=''; }
      else if((c==='\n'||c==='\r') && !q){ if(cur.length||row.length){ row.push(cur.trim()); rows.push(row); row=[]; cur=''; } }
      else cur+=c;
    }
    if(cur.length||row.length){ row.push(cur.trim()); rows.push(row); }
    const header = rows.shift().map(h=>h.toLowerCase());
    return rows.map(cols=>{ const o={}; header.forEach((h,i)=>o[h]=cols[i]||''); return o; });
  }

  /* ðŸ”¹ DM butonu artÄ±k Instagram sayfasÄ±na yÃ¶nlendiriyor */
  function cardTemplate(item){
    const title = item.title || 'â€”';
    const brand = item.brand || '';
    const price = item.price ? `$${item.price}` : '';
    const img = item.image || 'logo.png';
    const link = item.payment_link || '#';
    const ariaTitle = `${brand?brand+' ':''}${title}`.trim();
    return `
      <article class="card">
        <div class="media"><img src="${img}" alt="${ariaTitle}"></div>
        <div class="body">
          <div class="title">${title}</div>
          <div class="brand">${brand}</div>
          <div class="price">${price}</div>
          <div class="actions">
            <a class="chip" href="${INSTAGRAM_URL}" target="_blank" rel="noopener" aria-label="${title} iÃ§in DM'den yaz">DM</a>
            <a class="chip fill" href="${link}" target="_blank" rel="noopener" aria-label="${title} iÃ§in Stripe ile satÄ±n al">Hemen SatÄ±n Al</a>
          </div>
        </div>
        <a class="buy" href="${link}" target="_blank" rel="noopener" aria-label="${title} satÄ±n al"></a>
      </article>
    `;
  }

  function renderBrands(){
    const wrap = document.getElementById('brands');
    wrap.innerHTML = BRANDS_FILES.map(src => `<img src="${src}" alt="">`).join('');
  }

  async function render(){
    const grid = document.getElementById('grid');
    try{
      const items = await fetchCSV(SHEET_CSV_URL);
      let active = items.filter(x => (x.status||'').toLowerCase()==='active');
      const TARGET = 12;
      if(active.length && active.length < TARGET){
        const fill = []; for(let i=0;i<TARGET;i++){ fill.push(active[i % active.length]); }
        active = fill;
      }
      grid.innerHTML = active.length
        ? active.slice(0, TARGET).map(cardTemplate).join('')
        : `<article class="card"><div class="media"><img src="logo.png" alt="" style="object-fit:contain;opacity:.3"></div><div class="body">
             <div class="title">Aktif Ã¼rÃ¼n yok</div><div class="brand">Sheetâ€™te status=active olan satÄ±r ekleyin.</div><div class="price">â€”</div>
           </div></article>`;
    }catch(e){
      console.error(e);
      const msg = (e && e.message) ? e.message : 'Bilinmeyen hata';
      document.getElementById('grid').innerHTML =
        `<article class="card"><div class="media"><img src="logo.png" alt="" style="object-fit:contain;opacity:.3"></div>
          <div class="body"><div class="title">Liste yÃ¼klenemedi</div><div class="brand">${msg}</div><div class="price">â€”</div></div></article>`;
    }
    renderBrands();
  }
  render();
</script>
